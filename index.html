<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Blackberry.js - a zero-build framework for the artisanal web">

        <style>body {transition: opacity .25s .3s;} [blackberry-cloak] {opacity: 0;}</style>

        <!--	Deps	-->
        <script src="https://unpkg.com/lenis@1.1.18/dist/lenis.min.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/lenis@1.1.18/dist/lenis.css" crossorigin="anonymous"">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" data-manual></script>

        <!--	Meta	-->
        <title>Blackberry.js - for the artisinal web</title>

        <!--	Init	-->
        <script type="module">
            import { start, Component, h } from "/dist/blackberry@0.0.1.js";

            start();

            const lenis = new Lenis({
                autoRaf: true,
                lerp: 0.15,
            });
        </script>

        <!-- 	Styles	-->
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap");
            @import url("https://fonts.googleapis.com/css2?family=VT323&display=swap");

            :root {
                --blackberry-dark: #1a1b26;
                --blackberry-main: #2e3440;
                --blackberry-light: #434c5e;
                --blackberry-accent: #88c0d0;
                --blackberry-text: #d8dee9;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background-color: var(--blackberry-dark);
                background-image: linear-gradient(
                        var(--blackberry-light) 1px,
                        transparent 1px
                    ),
                    linear-gradient(
                        90deg,
                        var(--blackberry-light) 1px,
                        transparent 1px
                    );
                background-size: 20px 20px;
                background-position: -1px -1px;
                color: var(--blackberry-text);
                font-family: sans-serif, monospace;
                padding: 2rem;
                position: relative;

                @media (max-width: 768px) {
                    padding: 1rem;
                }
            }

            body::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--blackberry-main);
                opacity: 0.7;
                pointer-events: none;
                z-index: 0;
            }

            .container {
                max-width: 1024px;
                margin: 0 auto;
                padding: 2rem;
                background-color: var(--blackberry-main);
                border: 4px solid var(--blackberry-light);
                box-shadow: 8px 8px 0 var(--blackberry-dark);
                position: relative;
                z-index: 1;

                @media (max-width: 768px) {
                    padding: 1rem;
                }
            }

            h1.title,
            h2.title,
            h3.title {
                color: var(--blackberry-accent);
                margin: 2rem 0 1rem;
                text-shadow: 2px 2px 0 var(--blackberry-dark);
            }

            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-family: "VT323", monospace;
            }

            h1.title {
                font-size: 4rem;
                text-align: center;
                margin-bottom: 2rem;
                @media (max-width: 550px) {
                    font-size: 1.55rem;
                }
            }

            h2.title {
                font-size: 3rem;
                /* border-bottom: 4px solid var(--blackberry-light); */
                padding-bottom: 0.5rem;
                @media (max-width: 550px) {
                    font-size: 1.25rem;
                }
            }

            h3.title {
                font-size: 2rem;
                margin-top: 2rem;
            }

            h4.title {
                font-size: 1.5rem;
                margin-top: 1rem;
            }

            .text {
                margin: 1rem 0;
                font-family: sans-serif;
                font-size: 1.125rem;
                line-height: 100%;
            }

            .header-logo-container {
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                margin: 2rem 0;

                @media (max-width: 768px) {
                    /* hide 2 */
                    & img:nth-child(2) {
                        display: none;
                    }
                }
            }

            .header-logo {
                display: block;
                margin: 0 auto;
                width: 100px;
                filter: drop-shadow(2px 2px 0 var(--blackberry-dark));
            }

            .feature-list {
                margin: 1rem 0;
                padding-left: 1rem;
            }

            .feature-list li {
                margin: 0.5rem 0;
                list-style: none;
                position: relative;
                padding-left: 1.5rem;
                font-size: 1.25rem;
            }

            .feature-list li::before {
                content: "â–º";
                position: absolute;
                left: 0;
                color: var(--blackberry-accent);
            }

            .note {
                background: var(--blackberry-light);
                padding: 0.5rem;
                margin: 1rem 0;
                border-left: 4px solid var(--blackberry-accent);
                font-size: 1.25rem;
                font-family: "VT323", monospace;
            }

            .text-center {
                text-align: center;
            }

            spacer-line {
                display: block;
                height: 4px;
                width: 100%;
                margin-top: 3rem;
                margin-bottom: 3rem;
                background: var(--blackberry-light);
            }

            spacer-berries {
                display: block;
                height: 4px;
                width: 100%;
            }
        </style>
    </head>
    <template>
        <script type="module">
          import { render, h, text, Fragment } from "/src/renderer.js"

          let Inputs = h(Fragment, {},
            h("input", { type: "email", placeholder: "Email" }),
            h("input", { type: "password", placeholder: "Password" })
          )

          let Form = () => h("form", {},
            h("p", {}, text("Email:")),
            h(Inputs, {}),
            h("button", { type: "submit" }, text("Submit"),
          ))

          const app = h("main", { foo: "bar" },
            text("Hello, world!"),
            h("button", { onclick: () => alert("WOO") }, text("Click me!")),
            h(Fragment, {},
              h("span", {}, text("Hello")),
              h("span", {}, text("World")),
            ),
            h("div", {}, [
              h("h1", {}, text("TITLE"))
            ]),
            h(Form, {}),
          )

          let root = document.getElementById("root")
          render(app, root)
          console.log(root._vnode)
        </script>
        <div id="root">

        </div>
    </template>
    <body>
        <!-- ##Counter Component -->
        <template blackberry="counter-component" attributes="initial">
            <button
                @click="increment"
                :text="`the count is ${count}`"
            ></button>
            <script>

                $state.count = Number($attributes.initial ?? 0);
                $state.increment = () => $state.count++
                $effect(() => console.log("count changed", $state.count));
            </script>
            <style>
                button {
                    background: var(--blackberry-light);
                    padding: 4px 8px;
                    border: 2px solid var(--blackberry-accent);
                    font-family: "VT323", monospace;
                    font-size: 2rem;
                    color: var(--blackberry-text);
                    box-shadow: 4px 4px 0 var(--blackberry-dark);
                    transition: all 90ms;

                    &:hover {
                        transform: translateY(-2px);
                        box-shadow: 6px 6px 0 var(--blackberry-dark);
                    }

                    &:active {
                        transform: translateY(2px);
                        box-shadow: 4px 4px 0 var(--blackberry-dark);
                    }
                }
            </style>
        </template>

        <!-- ##Spacer Line Component -->
        <template blackberry="x-note">
            <div>
                <p>
                    ðŸ’¡ <span><slot></slot></span>
                </p>
            </div>
            <style>
                div {
                    background: var(--blackberry-light);
                    padding: 2px 0.25rem;
                    margin: 1rem 0;
                    border-left: 4px solid var(--blackberry-accent);
                    font-size: 1.25rem;
                    font-family: "VT323", monospace;
                }
            </style>
        </template>

        <!-- ##Inline Code Component -->
        <template blackberry="inline-code">
            <code><slot></slot></code>
            <style>
                code {
                    padding: 2px 0.25rem;
                    margin: .5rem 0;
                    color: var(--blackberry-accent);
                    font-size: 1.4rem;
                    font-family: "VT323", monospace;
                    border-radius: 4px;
                }
            </style>
        </template>

        <!-- ##Code Block Component -->
        <template blackberry="code-block" attributes="language, content">
            <script>
                const content = $attributes.content
                    .split("\n")
                if(content.length > 1) {
                    content.shift()
                }
                let indent = 0;
                for (let i = 0; i < content[0].length; i++) {
                    if (content[0][i] === "\t" || content[0][i] === " ") indent++;
                    else break;
                }
                for (let i = 0; i < content.length; i++) {
                    let char = 0;
                    let str = content[i];
                    while ((str[char] === "\t" || str[char] === " ") && char < indent) {
                        content[i] = content[i].slice(1);
                        char++;
                    }
                }
                $state.className = `language-` + $attributes.language;
                $state.content = Prism.highlight(content.join("\n").trim(), Prism.languages[$attributes.language], $attributes.language);
            </script>
            <pre><code :class="className" :html="content"></code></pre>
            <style>
                pre[class*="language-"],
                code[class*="language-"] {
                    color: #d8dee9;
                    font-size: 1em;
                    text-shadow: none;
                    font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono",
                        monospace;
                    direction: ltr;
                    text-align: left;
                    white-space: pre;
                    word-spacing: normal;
                    word-break: normal;
                    line-height: 1.5;
                    -moz-tab-size: 4;
                    -o-tab-size: 4;
                    tab-size: 4;
                    -webkit-hyphens: none;
                    -moz-hyphens: none;
                    -ms-hyphens: none;
                    hyphens: none;
                }
                pre[class*="language-"]::selection,
                code[class*="language-"]::selection,
                pre[class*="language-"]::mozselection,
                code[class*="language-"]::mozselection {
                    text-shadow: none;
                    background: none;
                }
                @media print {
                    pre[class*="language-"],
                    code[class*="language-"] {
                        text-shadow: none;
                    }
                }
                pre[class*="language-"] {
                    padding: 1em;
                    margin: 0.5em 0;
                    overflow: auto;
                    background: #2e3440;
                }
                :not(pre) > code[class*="language-"] {
                    padding: 0.1em;
                    border-radius: 0.3em;
                    color: #d8dee9;
                    background: #2e3440;
                }
                /*********************************************************
                * Tokens
                */
                .namespace {
                    opacity: 0.7;
                }
                .token.comment,
                .token.prolog,
                .token.doctype,
                .token.cdata {
                    color: #606e87;
                }
                .token.punctuation {
                    color: #81a1c1;
                }
                .token.property,
                .token.tag,
                .token.boolean,
                .token.number,
                .token.constant,
                .token.symbol,
                .token.deleted {
                    color: var(--blackberry-text);
                }
                .token.selector,
                .token.attr-name,
                .token.string,
                .token.char,
                .token.builtin,
                .token.inserted {
                    color: var(--blackberry-accent);
                }
                .token.operator,
                .token.entity,
                .token.url,
                .language-css .token.string,
                .style .token.string {
                    color: #80a2c1;
                    background: none;
                }
                .token.atrule,
                .token.attr-value,
                .token.keyword {
                    color: #81a1c1;
                }
                .token.function {
                    color: #8fbcbc;
                }
                .token.regex,
                .token.important,
                .token.variable {
                    color: #ee9900;
                }
                .token.important,
                .token.bold {
                    font-weight: bold;
                }
                .token.italic {
                    font-style: italic;
                }
                .token.entity {
                    cursor: help;
                }
                /*********************************************************
                * Line highlighting
                */
                pre[data-line] {
                    position: relative;
                }
                pre[class*="language-"] > code[class*="language-"] {
                    position: relative;
                    z-index: 1;
                }
                .line-highlight {
                    position: absolute;
                    left: 0;
                    right: 0;
                    padding: inherit 0;
                    margin-top: 1em;
                    background: #3b4251;
                    box-shadow: inset 5px 0 0 #d8dee9;
                    z-index: 0;
                    pointer-events: none;
                    line-height: inherit;
                    white-space: pre;
                }

                /* Custom */
                pre {
                    background: var(--blackberry-dark) !important;
                    border: 2px solid var(--blackberry-light);
                    overflow-x: auto;
                    font-family: monospace;
                    font-size: 1rem;
                    padding: 1rem;
                }
            </style>
        </template>

        <!-- ##Page Content -->
        <div class="container">

            <!-- ##Header -->
            <h1 class="title">Blackberry.js</h1>
            <div class="header-logo-container">
                <img class="header-logo" src="/assets/blackberry.png" />
                <img class="header-logo" src="/assets/blackberry.png" />
                <img class="header-logo" src="/assets/blackberry.png" />
                <img class="header-logo" src="/assets/blackberry.png" />
                <img class="header-logo" src="/assets/blackberry.png" />
            </div>

            <p class="text text-center">
                A zero-build framework for the artisanal web.
            </p>

            <spacer-line></spacer-line>

            <!-- ##Overview -->
            <h2 class="title">Overview</h2>
            <p class="text">
                Blackberry is a small frontend library providing reactivity, composability,
                scoped styles, and a simple API to make webdev fun again.
            </p>

            <!-- Example -->
            <code-block language="html" content='
                <template blackberry="counter-component" attributes="initial">

                    <button @click="increment" :text="`the count is ${count}`"></button>

                    <script>
                        $state.count = Number( $attributes.initial ?? 0 );
                        $state.increment = () => $state.count++;
                        $effect(() => console.log( "count changed", $state.count ));
                    </script>

                    <style>
                        button { ... }
                    </style>

                </template>
            '></code-block>

            <code-block language="html" content='
                <counter-component initial="3"></counter-component>
            '></code-block>

            <counter-component initial="3"></counter-component>

            <p class="text">
                Blackberry.js is inspired by
                <a href="https://strawberry.quest" target="_blank">Strawberry.js</a>,
                and is designed to be used as a lightweight html-first
                alternative to frameworks like Vue and Svelte without
                requiring build tooling or a complex dependency tree.
            </p>

            <spacer-line></spacer-line>

            <!-- ##SETUP -->

            <h2 class="title">Setup</h2>
            <p class="text">
                To get started, include the Blackberry.js script in your html file.
                Calling <inline-code>Blackberry.start()</inline-code> parses
                and registers any components defined in the document. Subsequent
                components can be defined in the document and
                Blackberry will automatically register them.
            </p>

            <code-block language="html" content='
                <script type="module">
                    import Blackberry from "https://esm.sh/blackberry.js"
                    Blackberry.start()
                </script>
            '></code-block>

            <spacer-line></spacer-line>

            <!-- ##GUIDE -->
            <h2 class="title">Guide</h2>
            <p class="text">
                Blackberry has a very simple API. Components are defined using
                the <inline-code>template</inline-code> tag with a <inline-code>blackberry</inline-code>
                attribute signifying the component name, which must contain a hyphen. Inside of the template,
                you can define elements the component should render, a <inline-code>script</inline-code>
                tag for state and logic, and a <inline-code>style</inline-code> tag for styling.
            </p>
            <code-block language="html" content='
                <template blackberry="hello-world" ">
                    <h1>Hello, world!</h1>
                    <script>
                        console.log("Hello, world!")
                    </script>
                    <style>
                        h1 { color: red; }
                    </style>
                </template>
            '></code-block>

            <h3 class="title">Script</h3>
            <p class="text">
                Blackberry components can define a top level <inline-code>script</inline-code> tag, which
                acts similarly to the script tag in Vue or Svelte components. It can be used to define
                reactive state, effects, cleanup functions, and access the underlying dom element of the component.
            </p>

            <h4 class="title">State</h4>
            <p class="text">
                Code inside of the <inline-code>script</inline-code> tag has access to a <inline-code>$state</inline-code> object
                which can be used to store reactive data. Any changes to the state will trigger a re-render of the component.
                This data can be directly accessed inside of the component's template.
            </p>
            <code-block language="html" content='
                <script>
                    $state.count = 0;
                    $state.actions = {
                        increment: () => $state.count++
                    }
                </script>
                <button @click="actions.increment">
                    <span :text="`the count is ${count}`"></span>
                </button>
            '></code-block>

            <h4 class="title">Attributes</h4>
            <p class="text">
                Attributes are values that can be passed into a component.
                They can be defined on a component's template tag using a comma seperated
                <inline-code>attributes</inline-code> attribute, and accessed via the reactive <inline-code>$attributes</inline-code> object.
            </p>
            <code-block language="html" content='
                <template blackberry="attribute-example" attributes="foo, bar">
                    <script>
                        // attributes can be accessed via the $attributes object
                        $state.foo = $attributes.foo;
                    </script>
                    <h1 :text="foo"></h1>
                    <!-- As well as inside of the template -->
                    <h2 :text="$attributes.bar"></h2>
                </template>

                <attribute-example foo="Hello" bar="World"></attribute-example>
            '></code-block>

            <h4 class="title">Effects</h4>
            <p class="text">
                The effect function is available inside of the script tag via the <inline-code>$effect</inline-code> value.
                They are automatically run when the component is rendered and whenever a reactive value inside the scope
                of the callback changes.
            </p>
            <code-block language="html" content='
                <script>
                    $effect(() => console.log("count changed", $state.count));
                </script>
                <button @click="increment" :text="`the count is ${count}`"></button>
            '></code-block>

            <h4 class="title">Element</h4>
            <p class="text">
                The underlying root element of a Blackberry element can be accessed via the <inline-code>$element</inline-code> value.
                This can be useful for accessing the dom element directly, which is needed to access properties on the element.
            </p>

            <h4 class="title">Cleanup</h4>
            <p class="text">
                Cleanup functions can be defined in the script tag using the <inline-code>$cleanup</inline-code> global and will be run when the component is removed from the dom.
                This can be useful for disposing any resources the component may have aquired.
            </p>

            <h4 class="title">Reactive </h4>
            <p class="text">
                If you want to create other reactive stores in your component, you can use the <inline-code>$reactive</inline-code> function.
            </p>

            <h3 class="title">Templating</h3>

            <h4 class="title">Directives</h4>
            <p class="text">
                Templates can use directives to bind data to elements, listen for events, and conditionally render elements.
                Directives are javascript expressions that are evaluated in the context of the component.
            </p>

            <h4 class="title">Attribute Directive</h4>
            <p class="text">
                The <inline-code>:</inline-code> directive binds the value of the expression to the attribute.
                Example: <inline-code>:foo="`the count is ${count}`"</inline-code> will set the attribute <inline-code>foo</inline-code> to the value of the expression.
            </p>

            <h4 class="title">:text</h4>
            <p class="text">
                This directive binds it's value as the text content of the node.
            </p>

            <h4 class="title">:if</h4>
            <p class="text">
                The :if directive conditionally renders the node based on the value of the expression.
            </p>

            <h4 class="title">:html</h4>
            <p class="text">
                This directive binds it's value as the innerHTML of the node.
                <x-note>Be careful when using this directive as it can be a security risk.</x-note>
            </p>

            <h4 class="title">:ref</h4>
            <p class="text">
                Refs are used to access the underlying dom element of a component.
                The <inline-code>:ref</inline-code> directive binds the value of the
                expression to the ref's <inline-code>value</inline-code> property.
            </p>

            <h4 class="title">Event directive</h4>
            <p class="text">
                The <inline-code>@</inline-code> directive binds it's value as an event listener.
                Example: <inline-code>@click="increment"</inline-code>
            </p>

            <h4 class="title">each:key</h4>
            <p class="text">
                The <inline-code>each:key</inline-code> directive renders a list of elements for each item in an array. It must be used on a template tag,
                and the template tag must have an <inline-code>each</inline-code> attribute with the value of the array to iterate over.
                The <inline-code>key</inline-code> attribute is used to specify a unique identifier for each item in the list.
            </p>
            <code-block language="html" content='
                <template blackberry="list-example">
                    <ul>
                        <template each:item="items">
                            <li :text="item.name" :key="item.id"></span></li>
                        </template>
                    </ul>
                    <script>
                        $state.items = [
                            { id: 1, name: "apple" },
                            { id: 2, name: "banana" },
                            { id: 3, name: "cherry" }
                        ]
                    </script>
                </template>
            '></code-block>

            <h4 class="title">Property Directive</h4>
            <p class="text">
                The <inline-code>.</inline-code> directive binds the value of the expression to the property.
                This is useful for passing values other than strings to components or elements.
            </p>
            <code-block language="html" content='
                <template blackberry="parent-component">
                    <child-component .hello="() => console.log(`Hello from parent!`)"></child-component>
                </template>

                <template blackberry="child-component">
                    <button @click="$element.hello">Click me!</button>
                </template>
            '></code-block>

            <h4 class="title">Slots</h4>
            <p class="text">
                Slots are used to pass content into a component. They are defined in the component's template using the <inline-code>slot</inline-code> tag.
                The content passed into the slot is rendered in place of the slot tag.
            </p>
            <code-block language="html" content='
                <template blackberry="slot-example">
                    <div>
                        <slot></slot>
                    </div>
                </template>

                <slot-example>
                    <h1>Hello, world!</h1>
                </slot-example>
            '></code-block>

            <h3 class="title">Styling</h3>
            <p class="text">
                Styles can be defined in the <inline-code>style</inline-code> tag of a component.
                Styles are scoped to the component and do not leak out.
            </p>
            <p class="text">
                Because Blackberry components use the shadow-dom, they do not have access to global stylesheets by default.
                If you want your component to inherit styles from the outside document,
                you can set the <inline-code>global-styles</inline-code> attribute on a component template.
            </p>
        </div>
    </body>
</html>
